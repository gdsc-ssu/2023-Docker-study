# 도커의 기본적인 사용법

### Intro

- docker container run : 컨테이너로 애플리케이션을 실행하라는거
- 빌드 ⇒ 공유 ⇒ 실해

### 컨테이너란 무엇일까?

- 컨테이너 안에는 애플리케이션이 있고, 이 애플리케이션에는 호스트명, IP주소, 디스크 드라이브가 있다.
    - 얘네는 모두 도커가 만들어낸 가상 리소스
- 컨테이너 안에서는 컨테이너 밖의 환경을 볼 수 없다.
- 컨테이너는 여러개 실행시킬 수 있다.
- 서로 독립적인 환경을 갖지만 컨테이너가 실행되는 컴퓨터의 CPU와 메모리, 운영체제를 공유한다.
    - 이런 구조를 통해 격리와 밀집이라는 조건을 동시에 만족시킬 수 있다.
    - 밀집 : 컴퓨터에 CPU와 메모리가 허용하는 한 되록 많은 수의 애플리케이션을 실행 (가상머신과 달리 운영체지를 공유하므로 리소스 크게 경감)
    - 격리 : 컨테이너는 외부와 독립된 환경 제공
    

### 컨테이너를 원격 컴퓨터처럼 사용하기



```python
docker container run --interactive --tty diamol/base
```

- —interactive 는 컨테이너에 접속된 상태
- **—tty는 터미널 세션을 통해 컨테이너 조작하겠다는거**

```python
docker contaienr ls
```

- 현재 실행중인 모든 컨테이너에 대한 정보를 볼 수 있음

```python
docker container logs f1
```

- f1컨테이너의 모든 로그 수집

```python
docker container inspect f1
```

- 컨테이너의 가상 파일 시스템상의 경로, 컨테이너에서 실행중인 명령, 해당 컨테이너가 접속된 가상 도커 네트워크 정보 등 애플리케이션에서 발생한 문제 추적하는데 유용한 정보 제공

### 컨테이너를 사용해 웹사이트 호스팅하기

```python
docker container ls --all
```

- 상태와 상관없이 모든 컨테이너의 목록 확인

1. 컨테이너 내부의 애플리케이션이 실행중이여야 컨테이너의 상태도 실행중이 된다.
    - 애플리케이션 프로세스가 종료되면 컨테이너의 상태도 existed가 된다.
2. 컨테이너가 종료돼도 컨테이너는 사라지지 않는다.
    - 나중에 컨테이너 다시 실행하거나 로그 확인 등등 가능
    - 컨테이너의 파일시스템이 그대로 남아있기에 호스트 컴퓨터의 디스크 공간 계속 점유

**컨테이너를 실행하고 백그라운드에서 동작하게 하려면..?**

🍎 질문 : 백그라운드에서 동작이 뭘까여?

- 다른거 작업을 해도 계속 도커가 돌아갈 수 있게 하는 것 ⇒ 백그라운드 실행

컨테이너가 백그라운드에서 동작하면서 네트워크를 listen하려면 docker container run 명령어에 두개의 플래그를 적용해야함

—detach : 컨테이너를 백그라운드에서 실행하며 컨테이너 ID출력 (겉으로 드러나지 않음)

—publish : 컨테이너의 포트를 호스트 컴퓨터에 공개 (도커 설치 ⇒ 호스트 컴퓨터의 네트워크 계층에 도커가 끼어들음 ⇒ 호스트 컴퓨터의 네트워크 트래픽을 모두 도커가 가로채서 그중 필요한 것을 컨테이너에 전달)

컨테이너는 외부환경에 노출되지 않기에 각 컨테이너는 고유의 IP주소를 갖지만 이 IP주소는 도커가 관리하는 내부 가상 네트워크 주소지, 호스트 컴퓨터가 연결된 물리 네트워크에 연결된 것이 아님!

컨테이너의 포트를 공개 ⇒ 토커가 호스트 컴퓨터의 포트를 주시하다가 해당 포트로 들어오는 트래픽을 컨테이너로 전달하는 것.

```python
docker container run --detach --publish 8080:80 diamol/ch02
```


호스트 컴퓨터의 8080번으로 들어온 트래픽이 컨테이너의 80번 포트로 전달됨

```python
docker container stats
```

- 실행중인 컨테이너의 상태를 확인가능하다.

```python
docker contaienr rm
```

- 컨테이너 삭제

### 도커가 컨테이너를 실행하는 원리

- 도커엔진 : 도커의 관리 기능을 맡는 컴포넌트 , 로컬 이미지 캐시를 담당하므로 새로운 이미지가 필요하면 이미지를 내려 받으며 기존 이미지가 있다면 전에 내려받은 이미지 사용
    
    도커엔진은 항시 동작하는 백그라운드 프로세스
    
- 도커 명령행 인터페이스 : 도커 CLI . 도커 API의 클라이언트 실제로 도커 API를 호출하는 것이 도커 CLI

[[Docker] 도커 명령어 사용해보기](https://doongjun.tistory.com/87)

도커 컨테이너 내부에 접속하는 방법

[docker container에 접속하기](https://bluese05.tistory.com/21)

[starting container process caused "exec: \"/bin/bash\": stat /bin/bash: no such file or directory": unknown](https://league-cat.tistory.com/377)

### 연습문제

[http://3.34.45.55:8088/index.html](http://3.34.45.55:8088/index.html)

### 보완해야할 점

```python
docker container cp index.html /usr/local/apache2/htdocs
```
